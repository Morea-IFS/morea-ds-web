{% extends 'layout.html' %}

{% load static %}

{% block title %}Morea | Gráficos do Dispositivo{% endblock %}

{% block stylesCustom %}
<link rel="stylesheet" href="{% static 'css/device_dashboard.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Dashboard de Monitoramento</h1>
        <p>Visualize em tempo real o consumo de todos os dispositivos instalados</p>
    </div>
    
    <div class="device-grid" id="device-grid">
        {% for device in devices %}
        <div class="device-card {% if device.type == 1 %}water-device{% elif device.type == 2 %}energy-device{% else %}gas-device{% endif %}"
             data-device-id="{{ device.id }}"
             data-device-type="{{ device.type }}"
             data-device-name="{{ device.name }}">
            <div class="device-icon">
                {% if device.type == 1 %}
                <i class="fa-icon fas fa-faucet"></i>
                {% elif device.type == 2 %}
                <i class="fa-icon fas fa-bolt"></i>
                {% else %}
                <i class="fa-icon fas fa-fire-alt"></i>
                {% endif %}
            </div>
            <div class="device-content">
                <h3 class="device-name">{{ device.name }}</h3>
                <div class="device-info">
                    <span class="info-label">Tipo:</span>
                    <span class="info-value">{{ device.get_type_display }}</span>
                </div>
                <div class="device-info">
                    <span class="info-label">Local:</span>
                    <span class="info-value">{{ device.location }}</span>
                </div>
                <div class="device-info">
                    <span class="info-label">Seção:</span>
                    <span class="info-value">{{ device.section }}</span>
                </div>
                <div class="device-status {% if device.is_authorized == 2 %}status-authorized{% else %}status-pending{% endif %}">
                    <span class="status-dot"></span>
                    {% if device.is_authorized == 2 %}
                        Autorizado
                    {% else %}
                        Pendente
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="icon-device"></i>
            </div>
            <h3>Nenhum dispositivo cadastrado no momento</h3>
        </div>
        {% endfor %}
    </div>
    
    <div id="dashboard-content" style="display: none;">
        <div class="dashboard-controls">
            <div class="time-period-selector">
                <button class="time-period-btn active" data-period="24h">
                    <i class="far fa-clock"></i>
                    Últimas 24 horas
                </button>
                <button class="time-period-btn" data-period="7d">
                    <i class="far fa-calendar"></i>
                    Última Semana
                </button>
                <button class="time-period-btn" data-period="30d">
                    <i class="fas fa-calendar-alt"></i>
                    Último Mês
                </button>
            </div>
            
            <div class="device-info-header">
                <h2 id="selected-device-name"></h2>
                <div class="period-summary">
                    <span id="period-summary-text"></span>
                </div>
            </div>
        </div>
        
        <div id="stats-grid" class="stats-grid"></div>
        
        <div class="consumption-summary">
            <h3><i class="fas fa-filter"></i> Resumo do Consumo</h3>
            <div class="summary-grid" id="consumption-summary"></div>
        </div>
        
        <div class="charts-section">
            <h3><i class="fas fa-chart-line"></i> Gráficos de Consumo</h3>
            <div class="charts-grid" id="charts-grid"></div>
        </div>
    </div>
    
    <div id="loading-container" class="loading-container" style="display: none;">
        <div class="loading-spinner"></div>
        <h3>Carregando dados...</h3>
        <p>Aguarde enquanto processamos as informações</p>
    </div>
    
    <div id="no-device-selected" class="no-device-selected">
        <div class="no-device-icon">
            <i class="fas fa-mouse-pointer fa-3x"></i>
        </div>
        <h3>Selecione um dispositivo</h3>
        <p>Clique em um dos dispositivos acima para visualizar seus dados</p>
    </div>
    
    <div id="error-message" class="error-message" style="display: none;"></div>
</div>
{% endblock %}

{% block scriptsCustom %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<script src="{% static 'js/device_dashboard.js' %}"></script>
{% endblock %}